components:
 - name: Organisational planning and commitments
   indicators:
    - Organisation strategy
    - Annual report
    - Allocation policy
    - Audit
    - Procurement policy
    - Country strategy or Memorandum of Understanding

 - name: Finance and budgets
   indicators:
    - Total organisation budget
    - Disaggregated budget
    - Project budget
    - Project budget documents
    - Commitments
    - Disbursements and expenditure
    - Capital spend

 - name: Project attributes
   indicators:
    - Title
    - Description
    - Planned dates
    - Actual dates
    - Current status
    - Contact details
    - Sectors
    - Sub-national location
    - Implementer
    - Unique ID

 - name: Joining-up development data
   indicators:
    - Flow type
    - Aid type
    - Finance type
    - Tied aid status
    - Conditions
    - Project procurement

 - name: Performance
   indicators:
    - Objectives
    - Impact appraisals
    - Reviews and evaluations
    - Results

indicators:
 - name: Organisation strategy
   tests:
    - name: Organisation strategy
      expression: |
       `document-link/category[@code="B02"]` should be present

 - name: Annual report
   tests:
    - name: Annual report
      expression: |
       `document-link/category[@code="B01"]` should be present

 - name: Allocation policy
   tests:
    - name: Allocation policy
      expression: |
       `document-link/category[@code="B04"]` should be present

 - name: Audit
   tests:
    - name: Audit
      expression: |
       `document-link/category[@code="B06"]` should be present

 - name: Procurement policy
   tests:
    - name: Procurement policy
      expression: |
       `document-link/category[@code="B05"]` should be present

 - name: Country strategy or Memorandum of Understanding
   tests: []

 - name: Total organisation budget
   tests: []

 - name: Disaggregated budget
   tests: []

 - name: Project budget
   tests:
    - name: Forward budget available
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and planned or actual end date is at least 6 months ahead
       and `default-aid-type/@code` is not G01
       then `budget` should be available forward annually
       or `planned-disbursement` should be available forward annually

    - name: Forward budget available by quarters
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and planned or actual end date is at least 6 months ahead
       and `default-aid-type/@code` is not G01
       then `budget` should be available forward quarterly
       or `planned-disbursement` should be available forward quarterly

 - name: Project budget documents
   tests:
    - name: Budget document
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `default-aid-type/@code` is not one of (A01, A02, G01)
       and `transaction/aid-type/@code` is not one of (A01, A02)
       then `document-link/category[@code="A05"]` should be present

 - name: Commitments
   tests:
    - name: Commitments
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then `transaction/transaction-type[@code="C"]` should be present
       or `transaction/transaction-type[@code="2"]` should be present

 - name: Disbursements and expenditure
   tests:
    - name: Disbursements
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then
       `transaction/transaction-type[@code="D"] |
        transaction/transaction-type[@code="3"]`
       should be present
       or
       `transaction/transaction-type[@code="E"] |
        transaction/transaction-type[@code="4"]`
       should be present

 - name: Project procurement
   tests:
    - name: Contract document
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `default-aid-type/@code` is not one of (A01, A02, G01)
       and `transaction/aid-type/@code` is not one of (A01, A02)
       then `document-link/category[@code="A06"]` should be present
       or `document-link/category[@code="A11"]` should be present

    - name: Tenders document
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `default-aid-type/@code` is not one of (A01, A02, G01)
       and `transaction/aid-type/@code` is not one of (A01, A02)
       then `document-link/category[@code="A10"]` should be present

 - name: Title
   tests:
    - name: Title
      expression: |
       `title/text() | title/narrative/text()` should be present

    - name: Title more than 10 characters
      expression: |
       `title/text() | title/narrative/text()` should have at least 10 characters

 - name: Description
   tests:
    - name: Description
      expression: |
       `description/text() | description/narrative/text()` should be present

    - name: Description more than 80 characters
      expression: |
       `description/text() | description/narrative/text()` should have at least 80 characters

 - name: Planned dates
   tests:
    - name: Planned start date
      expression: |
       `activity-date[@type="start-planned"] | activity-date[@type="1"]` should be present

    - name: Planned end date
      expression: |
       `activity-date[@type="end-planned"] | activity-date[@type="3"]` should be present

 - name: Actual dates
   tests:
    - name: Actual start date
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then `activity-date[@type="start-actual"] | activity-date[@type="2"]` should be present

    - name: Actual end date
      expression: |
       if `activity-status/@code` is one of (3, 4)
       then `activity-date[@type="end-actual"] | activity-date[@type="4"]` should be present

 - name: Current status
   tests:
    - name: Activity status
      expression: |
       `activity-status` should be present

    - name: Activity status uses standard codelist
      expression: |
       at least one `activity-status/@code` should be on the ActivityStatus codelist

 - name: Contact details
   tests:
    - name: Contact information
      expression: |
       `contact-info` should be present

 - name: Sectors
   tests:
    - name: Sectors
      expression: |
       `sector` should be present
       or `transaction/sector` should be present

    - name: Sectors use standard codelist
      expression: |
       at least one
         `sector[@vocabulary="DAC"]/@code |
          sector[not(@vocabulary)]/@code |
          sector[@vocabulary="1"]/@code |
          transaction/sector[@vocabulary="1"]/@code |
          transaction/sector[not(@vocabulary)]/@code`
       should be on the Sector codelist

 - name: Sub-national location
   tests:
    - name: Location (sub-national)
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `recipient-region/@code` is not 998
       and `sector/@code` is not 91010
       then `location` should be present

    - name: Location (sub-national) coordinates or point
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `recipient-region/@code` is not 998
       then `location/coordinates` should be present
       or `location/point` should be present

 - name: Unique ID
   tests:
    - name: Unique IATI Identifier
      expression: |
       `iati-identifier` should be present

    - name: IATI Identifier starts with reporting org ref
      expression: |
       `iati-identifier/text()`
       should start with `reporting-org/@ref`
       or `iati-identifier/text()`
       should start with `other-identifier[@type="B1"]/@ref`

 - name: Implementer
   tests:
    - name: Implementing organisation
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then
       `participating-org[@role="Implementing"] |
        participating-org[@role="4"]` should be present

 - name: Flow type
   tests:
    - name: Flow type
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then `default-flow-type` should be present
       or `transaction/flow-type` should be present

    - name: Flow type uses standard codelist
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then at least one `default-flow-type/@code` should be on the FlowType codelist
       or at least one `transaction/flow-type/@code` should be on the FlowType codelist

 - name: Aid type
   tests:
    - name: Default aid type
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then `default-aid-type` should be present
       or `transaction/aid-type` should be present

    - name: Aid type uses standard codelist
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then at least one `default-aid-type/@code` should be on the AidType codelist
       or at least one `transaction/aid-type/@code` should be on the AidType codelist

 - name: Finance type
   tests:
    - name: Default finance type
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then `default-finance-type` should be present
       or `transaction/finance-type` should be present

    - name: Finance type uses standard codelist
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then at least one `default-finance-type/@code` should be on the FinanceType codelist
       or at least one `transaction/finance-type/@code` should be on the FinanceType codelist

 - name: Tied aid status
   tests:
    - name: Tied aid status
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then `default-tied-status` should be present
       or `transaction/tied-status` should be present

    - name: Tied aid status uses standard codelist
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then at least one `default-tied-status/@code` should be on the TiedStatus codelist
       or at least one `transaction/tied-status/@code` should be on the TiedStatus codelist

 - name: Conditions
   tests:
    - name: Conditions data
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then `conditions` should be present

    - name: Conditions document
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       then `document-link/category[@code="A04"]` should be present

 - name: Capital spend
   tests:
    - name: Capital spend
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `default-aid-type/@code` is not one of (A01, A02, G01)
       and `transaction/aid-type/@code` is not one of (A01, A02)
       then `capital-spend` should be present

 - name: Objectives
   tests:
    - name: Objectives of activity document
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `default-aid-type/@code` is not G01
       then `document-link/category[@code="A02"]` should be present
       or `description[@type="2"]` should be present

 - name: Impact appraisals
   tests:
    - name: Pre- and post-project impact appraisal documents
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `default-aid-type/@code` is not G01
       then `document-link/category[@code="A01"]` should be present

 - name: Reviews and evaluations
   tests:
    - name: Project performance and evaluation document
      expression: |
       if `activity-status/@code` is one of (3, 4)
       and `default-aid-type/@code` is not G01
       then `document-link/category[@code="A07"]` should be present

 - name: Results
   tests:
    - name: Results data
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `default-aid-type/@code` is not G01
       then `result` should be present

    - name: Results document
      expression: |
       if `activity-status/@code` is one of (2, 3, 4)
       and `default-aid-type/@code` is not G01
       then `document-link/category[@code="A08"]` should be present

filter:
  name: Current activities
  expression: |
   `activity-date[@type="end-planned"]/@iso-date |
       activity-date[@type="end-planned"]/text() |
       activity-date[@type="3"]/@iso-date |
       activity-date[@type="3"]/text()`
      is less than 12 months ago
   or
   `activity-date[@type="end-actual"]/@iso-date |
       activity-date[@type="end-actual"]/text() |
       activity-date[@type="4"]/@iso-date |
       activity-date[@type="4"]/text()`
      is less than 12 months ago
   or
   for at least one
      `transaction[transaction-type/@code="D"] |
       transaction[transaction-type/@code="E"] |
       transaction[transaction-type/@code="3"] |
       transaction[transaction-type/@code="4"]`,
      `transaction-date/@iso-date` is less than 12 months ago
